{"version":3,"sources":["imagetools/plugin.js"],"names":["eq","call","id","type","Cell","initial","value","get","set","v","global","tinymce","util","Tools","resolve","global$1","noop","constant","never","always","none","NONE","o","isNone","fold","n","_s","is","isSome","getOr","getOrThunk","thunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","a","constant_a","self","me","f","s","elementEq","b","Optional","from","isNonNullable","isNullable","isFunction","create","width","height","resize","document","createElement","clone","canvas","tCanvas","get2dContext","drawImage","getContext","Promise","window","fn","this","TypeError","_state","_value","_deferreds","doResolve","reject","anyWindow","asap","immediateFn","setImmediate","setTimeout","thisArg","apply","arguments","isArray","Array","Object","prototype","handle","deferred","cb","onFulfilled","onRejected","ret","e","push","newValue","then","finale","_i","_a","length","Handler","done","reason","ex","catch","all","values","args","slice","remaining","res","i","val","constructor","race","values_1","promise","imageToBlob","image","url","src","indexOf","dataUriToBlob","xhr","XMLHttpRequest","open","responseType","onload","status","response","onerror","_this","corsError","obj","code","name","genericError","send","blobToImage","blob","blobUrl","URL","createObjectURL","Image","removeListeners","removeEventListener","loaded","error","addEventListener","complete","uri","data","split","matches","exec","mimetype","base64","sliceSize","byteCharacters","atob","bytesLength","slicesCount","Math","ceil","byteArrays","sliceIndex","begin","end","min","bytes","offset","charCodeAt","Uint8Array","Blob","dataUriToBlobSync","canvasToBlob","quality","HTMLCanvasElement","toBlob","toDataURL","blobToCanvas","revokeObjectURL","revokeImageUrl","naturalWidth","getWidth","naturalHeight","getHeight","find","xs","pred","until","len","x","findUntil","create$1","getCanvas","initialType","toAdjustedDataURL","canvasToDataURL","getType","toBase64","toAdjustedBlob","toAdjustedBase64","dataurl","toCanvas","fromBlob","reader","FileReader","onloadend","result","readAsDataURL","blobToDataUri","fromCanvas","rotate","ir","angle","context","translateX","translateY","translate","PI","applyRotate","flip","axis","scale","applyFlip","keys","sendRequest","headers","withCredentials","onreadystatechange","readyState","props","k","each$1","key","setRequestHeader","friendlyHttpErrors","message","friendlyServiceErrors","handleHttpError","getHttpErrorMsg","getServiceErrorMsg","getServiceError","text","JSON","parse","parseJson","err","json","path","acc","handleServiceError","readAsText","readBlobText","serviceError","isError","requestServiceBlob","apiKey","Content-Type","tiny-api-key","separator","test","encodeURIComponent","appendApiKey","isServiceErrorCode","getUrl","requestBlob","blobToImageResult","fromDom","node","dom","SugarElement","fromHtml","html","scope","div","innerHTML","hasChildNodes","childNodes","console","fromTag","tag","fromText","createTextNode","fromPoint","docElm","y","elementFromPoint","child$1","Function","selector","predicate","child","element","nodeType","elem","msMatchesSelector","webkitMatchesSelector","mozMatchesSelector","global$2","global$3","global$4","getToolbarItems","editor","getParam","getProxyUrl","getImageSize","img","isPxValue","style","w","parseInt","h","getNaturalImageSize","count","getFigureImg","isFigure","isImage","imgNode","getEditableImage","isEditable","isLocalImage","isCorsImage","displayError","notificationManager","getSelectedImage","selection","getNode","figureElm","getParent","extractFilename","group","m","match","encode","host","documentBaseURI","inArray","getCorsHosts","defaultFetchImage","getCredentialsHosts","isCorsWithCredentialsImage","proxyUrl","getApiKey","imageToBlob$2","getFetchImage","customFetchImage","findBlob","blobInfo","editorUpload","blobCache","getByUri","cancelTimedUpload","imageUploadTimerState","clearTimeout","updateSelectedImage","origBlob","uploadImmediately","selectedImage","size","filename","useFilename","shouldReuseFilename","add","undoManager","transact","$","on","imageLoadedHandler","off","nodeChanged","uploadImagesAuto","imageUploadTimer","setEditorTimeout","getUploadTimeout","startTimedUpload","attr","blobUri","removeAttr","selectedImageOperation","_scanForImages","imageResult","rotate$2","flippedSize","rotate$1","flip$2","flip$1","handleDialogBlob","originalSize","blobToImage$1","newImage","newSize","removeAttribute","setAttribute","String","setImageSize","makeOpen","originalImgOpt","originalSizeOpt","origImg","_","state","createState","windowManager","title","body","items","label","currentState","buttons","primary","disabled","onSubmit","api","getData","imagetools","originalImg","close","onCancel","onAction","details","enable","disable","lastSelectedImageState","mceImageRotateLeft","mceImageRotateRight","mceImageFlipVertical","mceImageFlipHorizontal","mceEditImage","cmd","addCommand","register","command","execCommand","ui","registry","addButton","tooltip","icon","onSetup","buttonApi","setDisabled","addContextMenu","update","register$1","addContextToolbar","position","register$2","lastSelectedImage","setup"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.6.2 (2020-12-08)\n */\n(function () {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var isSimpleType = function (type) {\n      return function (value) {\n        return typeof value === type;\n      };\n    };\n    var isNullable = function (a) {\n      return a === null || a === undefined;\n    };\n    var isNonNullable = function (a) {\n      return !isNullable(a);\n    };\n    var isFunction = isSimpleType('function');\n\n    function create(width, height) {\n      return resize(document.createElement('canvas'), width, height);\n    }\n    function clone(canvas) {\n      var tCanvas = create(canvas.width, canvas.height);\n      var ctx = get2dContext(tCanvas);\n      ctx.drawImage(canvas, 0, 0);\n      return tCanvas;\n    }\n    function get2dContext(canvas) {\n      return canvas.getContext('2d');\n    }\n    function resize(canvas, width, height) {\n      canvas.width = width;\n      canvas.height = height;\n      return canvas;\n    }\n\n    function getWidth(image) {\n      return image.naturalWidth || image.width;\n    }\n    function getHeight(image) {\n      return image.naturalHeight || image.height;\n    }\n\n    var promise = function () {\n      var Promise = function (fn) {\n        if (typeof this !== 'object') {\n          throw new TypeError('Promises must be constructed via new');\n        }\n        if (typeof fn !== 'function') {\n          throw new TypeError('not a function');\n        }\n        this._state = null;\n        this._value = null;\n        this._deferreds = [];\n        doResolve(fn, bind(resolve, this), bind(reject, this));\n      };\n      var anyWindow = window;\n      var asap = Promise.immediateFn || typeof anyWindow.setImmediate === 'function' && anyWindow.setImmediate || function (fn) {\n        setTimeout(fn, 1);\n      };\n      function bind(fn, thisArg) {\n        return function () {\n          return fn.apply(thisArg, arguments);\n        };\n      }\n      var isArray = Array.isArray || function (value) {\n        return Object.prototype.toString.call(value) === '[object Array]';\n      };\n      function handle(deferred) {\n        var me = this;\n        if (this._state === null) {\n          this._deferreds.push(deferred);\n          return;\n        }\n        asap(function () {\n          var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\n          if (cb === null) {\n            (me._state ? deferred.resolve : deferred.reject)(me._value);\n            return;\n          }\n          var ret;\n          try {\n            ret = cb(me._value);\n          } catch (e) {\n            deferred.reject(e);\n            return;\n          }\n          deferred.resolve(ret);\n        });\n      }\n      function resolve(newValue) {\n        try {\n          if (newValue === this) {\n            throw new TypeError('A promise cannot be resolved with itself.');\n          }\n          if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n            var then = newValue.then;\n            if (typeof then === 'function') {\n              doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\n              return;\n            }\n          }\n          this._state = true;\n          this._value = newValue;\n          finale.call(this);\n        } catch (e) {\n          reject.call(this, e);\n        }\n      }\n      function reject(newValue) {\n        this._state = false;\n        this._value = newValue;\n        finale.call(this);\n      }\n      function finale() {\n        for (var _i = 0, _a = this._deferreds; _i < _a.length; _i++) {\n          var deferred = _a[_i];\n          handle.call(this, deferred);\n        }\n        this._deferreds = [];\n      }\n      function Handler(onFulfilled, onRejected, resolve, reject) {\n        this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n        this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n        this.resolve = resolve;\n        this.reject = reject;\n      }\n      function doResolve(fn, onFulfilled, onRejected) {\n        var done = false;\n        try {\n          fn(function (value) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onFulfilled(value);\n          }, function (reason) {\n            if (done) {\n              return;\n            }\n            done = true;\n            onRejected(reason);\n          });\n        } catch (ex) {\n          if (done) {\n            return;\n          }\n          done = true;\n          onRejected(ex);\n        }\n      }\n      Promise.prototype.catch = function (onRejected) {\n        return this.then(null, onRejected);\n      };\n      Promise.prototype.then = function (onFulfilled, onRejected) {\n        var me = this;\n        return new Promise(function (resolve, reject) {\n          handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\n        });\n      };\n      Promise.all = function () {\n        var values = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          values[_i] = arguments[_i];\n        }\n        var args = Array.prototype.slice.call(values.length === 1 && isArray(values[0]) ? values[0] : values);\n        return new Promise(function (resolve, reject) {\n          if (args.length === 0) {\n            return resolve([]);\n          }\n          var remaining = args.length;\n          function res(i, val) {\n            try {\n              if (val && (typeof val === 'object' || typeof val === 'function')) {\n                var then = val.then;\n                if (typeof then === 'function') {\n                  then.call(val, function (val) {\n                    res(i, val);\n                  }, reject);\n                  return;\n                }\n              }\n              args[i] = val;\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            } catch (ex) {\n              reject(ex);\n            }\n          }\n          for (var i = 0; i < args.length; i++) {\n            res(i, args[i]);\n          }\n        });\n      };\n      Promise.resolve = function (value) {\n        if (value && typeof value === 'object' && value.constructor === Promise) {\n          return value;\n        }\n        return new Promise(function (resolve) {\n          resolve(value);\n        });\n      };\n      Promise.reject = function (reason) {\n        return new Promise(function (resolve, reject) {\n          reject(reason);\n        });\n      };\n      Promise.race = function (values) {\n        return new Promise(function (resolve, reject) {\n          for (var _i = 0, values_1 = values; _i < values_1.length; _i++) {\n            var value = values_1[_i];\n            value.then(resolve, reject);\n          }\n        });\n      };\n      return Promise;\n    };\n    var Promise = window.Promise ? window.Promise : promise();\n\n    function imageToBlob(image) {\n      var src = image.src;\n      if (src.indexOf('data:') === 0) {\n        return dataUriToBlob(src);\n      }\n      return anyUriToBlob(src);\n    }\n    function blobToImage(blob) {\n      return new Promise(function (resolve, reject) {\n        var blobUrl = URL.createObjectURL(blob);\n        var image = new Image();\n        var removeListeners = function () {\n          image.removeEventListener('load', loaded);\n          image.removeEventListener('error', error);\n        };\n        function loaded() {\n          removeListeners();\n          resolve(image);\n        }\n        function error() {\n          removeListeners();\n          reject('Unable to load data of type ' + blob.type + ': ' + blobUrl);\n        }\n        image.addEventListener('load', loaded);\n        image.addEventListener('error', error);\n        image.src = blobUrl;\n        if (image.complete) {\n          loaded();\n        }\n      });\n    }\n    function anyUriToBlob(url) {\n      return new Promise(function (resolve, reject) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', url, true);\n        xhr.responseType = 'blob';\n        xhr.onload = function () {\n          if (this.status === 200) {\n            resolve(this.response);\n          }\n        };\n        xhr.onerror = function () {\n          var _this = this;\n          var corsError = function () {\n            var obj = new Error('No access to download image');\n            obj.code = 18;\n            obj.name = 'SecurityError';\n            return obj;\n          };\n          var genericError = function () {\n            return new Error('Error ' + _this.status + ' downloading image');\n          };\n          reject(this.status === 0 ? corsError() : genericError());\n        };\n        xhr.send();\n      });\n    }\n    function dataUriToBlobSync(uri) {\n      var data = uri.split(',');\n      var matches = /data:([^;]+)/.exec(data[0]);\n      if (!matches) {\n        return Optional.none();\n      }\n      var mimetype = matches[1];\n      var base64 = data[1];\n      var sliceSize = 1024;\n      var byteCharacters = atob(base64);\n      var bytesLength = byteCharacters.length;\n      var slicesCount = Math.ceil(bytesLength / sliceSize);\n      var byteArrays = new Array(slicesCount);\n      for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {\n        var begin = sliceIndex * sliceSize;\n        var end = Math.min(begin + sliceSize, bytesLength);\n        var bytes = new Array(end - begin);\n        for (var offset = begin, i = 0; offset < end; ++i, ++offset) {\n          bytes[i] = byteCharacters[offset].charCodeAt(0);\n        }\n        byteArrays[sliceIndex] = new Uint8Array(bytes);\n      }\n      return Optional.some(new Blob(byteArrays, { type: mimetype }));\n    }\n    function dataUriToBlob(uri) {\n      return new Promise(function (resolve, reject) {\n        dataUriToBlobSync(uri).fold(function () {\n          reject('uri is not base64: ' + uri);\n        }, resolve);\n      });\n    }\n    function canvasToBlob(canvas, type, quality) {\n      type = type || 'image/png';\n      if (isFunction(HTMLCanvasElement.prototype.toBlob)) {\n        return new Promise(function (resolve, reject) {\n          canvas.toBlob(function (blob) {\n            if (blob) {\n              resolve(blob);\n            } else {\n              reject();\n            }\n          }, type, quality);\n        });\n      } else {\n        return dataUriToBlob(canvas.toDataURL(type, quality));\n      }\n    }\n    function canvasToDataURL(canvas, type, quality) {\n      type = type || 'image/png';\n      return canvas.toDataURL(type, quality);\n    }\n    function blobToCanvas(blob) {\n      return blobToImage(blob).then(function (image) {\n        revokeImageUrl(image);\n        var canvas = create(getWidth(image), getHeight(image));\n        var context = get2dContext(canvas);\n        context.drawImage(image, 0, 0);\n        return canvas;\n      });\n    }\n    function blobToDataUri(blob) {\n      return new Promise(function (resolve) {\n        var reader = new FileReader();\n        reader.onloadend = function () {\n          resolve(reader.result);\n        };\n        reader.readAsDataURL(blob);\n      });\n    }\n    function revokeImageUrl(image) {\n      URL.revokeObjectURL(image.src);\n    }\n\n    var blobToImage$1 = function (blob) {\n      return blobToImage(blob);\n    };\n    var imageToBlob$1 = function (image) {\n      return imageToBlob(image);\n    };\n\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var findUntil = function (xs, pred, until) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Optional.some(x);\n        } else if (until(x, i)) {\n          break;\n        }\n      }\n      return Optional.none();\n    };\n    var find = function (xs, pred) {\n      return findUntil(xs, pred, never);\n    };\n\n    function create$1(getCanvas, blob, uri) {\n      var initialType = blob.type;\n      var getType = constant(initialType);\n      function toBlob() {\n        return Promise.resolve(blob);\n      }\n      var toDataURL = constant(uri);\n      function toBase64() {\n        return uri.split(',')[1];\n      }\n      function toAdjustedBlob(type, quality) {\n        return getCanvas.then(function (canvas) {\n          return canvasToBlob(canvas, type, quality);\n        });\n      }\n      function toAdjustedDataURL(type, quality) {\n        return getCanvas.then(function (canvas) {\n          return canvasToDataURL(canvas, type, quality);\n        });\n      }\n      function toAdjustedBase64(type, quality) {\n        return toAdjustedDataURL(type, quality).then(function (dataurl) {\n          return dataurl.split(',')[1];\n        });\n      }\n      function toCanvas() {\n        return getCanvas.then(clone);\n      }\n      return {\n        getType: getType,\n        toBlob: toBlob,\n        toDataURL: toDataURL,\n        toBase64: toBase64,\n        toAdjustedBlob: toAdjustedBlob,\n        toAdjustedDataURL: toAdjustedDataURL,\n        toAdjustedBase64: toAdjustedBase64,\n        toCanvas: toCanvas\n      };\n    }\n    function fromBlob(blob) {\n      return blobToDataUri(blob).then(function (uri) {\n        return create$1(blobToCanvas(blob), blob, uri);\n      });\n    }\n    function fromCanvas(canvas, type) {\n      return canvasToBlob(canvas, type).then(function (blob) {\n        return create$1(Promise.resolve(canvas), blob, canvas.toDataURL());\n      });\n    }\n\n    function rotate(ir, angle) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyRotate(canvas, ir.getType(), angle);\n      });\n    }\n    function applyRotate(image, type, angle) {\n      var canvas = create(image.width, image.height);\n      var context = get2dContext(canvas);\n      var translateX = 0;\n      var translateY = 0;\n      angle = angle < 0 ? 360 + angle : angle;\n      if (angle === 90 || angle === 270) {\n        resize(canvas, canvas.height, canvas.width);\n      }\n      if (angle === 90 || angle === 180) {\n        translateX = canvas.width;\n      }\n      if (angle === 270 || angle === 180) {\n        translateY = canvas.height;\n      }\n      context.translate(translateX, translateY);\n      context.rotate(angle * Math.PI / 180);\n      context.drawImage(image, 0, 0);\n      return fromCanvas(canvas, type);\n    }\n    function flip(ir, axis) {\n      return ir.toCanvas().then(function (canvas) {\n        return applyFlip(canvas, ir.getType(), axis);\n      });\n    }\n    function applyFlip(image, type, axis) {\n      var canvas = create(image.width, image.height);\n      var context = get2dContext(canvas);\n      if (axis === 'v') {\n        context.scale(1, -1);\n        context.drawImage(image, 0, -canvas.height);\n      } else {\n        context.scale(-1, 1);\n        context.drawImage(image, -canvas.width, 0);\n      }\n      return fromCanvas(canvas, type);\n    }\n\n    var flip$1 = function (ir, axis) {\n      return flip(ir, axis);\n    };\n    var rotate$1 = function (ir, angle) {\n      return rotate(ir, angle);\n    };\n\n    var keys = Object.keys;\n    var each$1 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n\n    var sendRequest = function (url, headers, withCredentials) {\n      if (withCredentials === void 0) {\n        withCredentials = false;\n      }\n      return new Promise(function (resolve) {\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            resolve({\n              status: xhr.status,\n              blob: xhr.response\n            });\n          }\n        };\n        xhr.open('GET', url, true);\n        xhr.withCredentials = withCredentials;\n        each$1(headers, function (value, key) {\n          xhr.setRequestHeader(key, value);\n        });\n        xhr.responseType = 'blob';\n        xhr.send();\n      });\n    };\n    var readBlobText = function (blob) {\n      return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          resolve(reader.result);\n        };\n        reader.onerror = function (e) {\n          reject(e);\n        };\n        reader.readAsText(blob);\n      });\n    };\n    var parseJson = function (text) {\n      try {\n        return Optional.some(JSON.parse(text));\n      } catch (ex) {\n        return Optional.none();\n      }\n    };\n\n    var friendlyHttpErrors = [\n      {\n        code: 404,\n        message: 'Could not find Image Proxy'\n      },\n      {\n        code: 403,\n        message: 'Rejected request'\n      },\n      {\n        code: 0,\n        message: 'Incorrect Image Proxy URL'\n      }\n    ];\n    var friendlyServiceErrors = [\n      {\n        type: 'not_found',\n        message: 'Failed to load image.'\n      },\n      {\n        type: 'key_missing',\n        message: 'The request did not include an api key.'\n      },\n      {\n        type: 'key_not_found',\n        message: 'The provided api key could not be found.'\n      },\n      {\n        type: 'domain_not_trusted',\n        message: 'The api key is not valid for the request origins.'\n      }\n    ];\n    var traverseJson = function (json, path) {\n      var value = foldl(path, function (result, key) {\n        return isNonNullable(result) ? result[key] : undefined;\n      }, json);\n      return Optional.from(value);\n    };\n    var isServiceErrorCode = function (code, blob) {\n      return (blob === null || blob === void 0 ? void 0 : blob.type) === 'application/json' && (code === 400 || code === 403 || code === 404 || code === 500);\n    };\n    var getHttpErrorMsg = function (status) {\n      var message = find(friendlyHttpErrors, function (error) {\n        return status === error.code;\n      }).fold(constant('Unknown ImageProxy error'), function (error) {\n        return error.message;\n      });\n      return 'ImageProxy HTTP error: ' + message;\n    };\n    var handleHttpError = function (status) {\n      var message = getHttpErrorMsg(status);\n      return Promise.reject(message);\n    };\n    var getServiceErrorMsg = function (type) {\n      return find(friendlyServiceErrors, function (error) {\n        return error.type === type;\n      }).fold(constant('Unknown service error'), function (error) {\n        return error.message;\n      });\n    };\n    var getServiceError = function (text) {\n      var serviceError = parseJson(text);\n      var errorMsg = serviceError.bind(function (err) {\n        return traverseJson(err, [\n          'error',\n          'type'\n        ]).map(getServiceErrorMsg);\n      }).getOr('Invalid JSON in service error message');\n      return 'ImageProxy Service error: ' + errorMsg;\n    };\n    var handleServiceError = function (blob) {\n      return readBlobText(blob).then(function (text) {\n        var serviceError = getServiceError(text);\n        return Promise.reject(serviceError);\n      });\n    };\n    var handleServiceErrorResponse = function (status, blob) {\n      return isServiceErrorCode(status, blob) ? handleServiceError(blob) : handleHttpError(status);\n    };\n\n    var appendApiKey = function (url, apiKey) {\n      var separator = url.indexOf('?') === -1 ? '?' : '&';\n      if (/[?&]apiKey=/.test(url)) {\n        return url;\n      } else {\n        return url + separator + 'apiKey=' + encodeURIComponent(apiKey);\n      }\n    };\n    var isError = function (status) {\n      return status < 200 || status >= 300;\n    };\n    var requestServiceBlob = function (url, apiKey) {\n      var headers = {\n        'Content-Type': 'application/json;charset=UTF-8',\n        'tiny-api-key': apiKey\n      };\n      return sendRequest(appendApiKey(url, apiKey), headers).then(function (result) {\n        return isError(result.status) ? handleServiceErrorResponse(result.status, result.blob) : Promise.resolve(result.blob);\n      });\n    };\n    var requestBlob = function (url, withCredentials) {\n      return sendRequest(url, {}, withCredentials).then(function (result) {\n        return isError(result.status) ? handleHttpError(result.status) : Promise.resolve(result.blob);\n      });\n    };\n    var getUrl = function (url, apiKey, withCredentials) {\n      if (withCredentials === void 0) {\n        withCredentials = false;\n      }\n      return apiKey ? requestServiceBlob(url, apiKey) : requestBlob(url, withCredentials);\n    };\n\n    var blobToImageResult = function (blob) {\n      return fromBlob(blob);\n    };\n\n    var ELEMENT = 1;\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: node };\n    };\n    var fromPoint = function (docElm, x, y) {\n      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n    };\n    var SugarElement = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var is = function (element, selector) {\n      var dom = element.dom;\n      if (dom.nodeType !== ELEMENT) {\n        return false;\n      } else {\n        var elem = dom;\n        if (elem.matches !== undefined) {\n          return elem.matches(selector);\n        } else if (elem.msMatchesSelector !== undefined) {\n          return elem.msMatchesSelector(selector);\n        } else if (elem.webkitMatchesSelector !== undefined) {\n          return elem.webkitMatchesSelector(selector);\n        } else if (elem.mozMatchesSelector !== undefined) {\n          return elem.mozMatchesSelector(selector);\n        } else {\n          throw new Error('Browser lacks native selectors');\n        }\n      }\n    };\n\n    var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n    var child = function (scope, predicate) {\n      var pred = function (node) {\n        return predicate(SugarElement.fromDom(node));\n      };\n      var result = find(scope.dom.childNodes, pred);\n      return result.map(SugarElement.fromDom);\n    };\n\n    var child$1 = function (scope, selector) {\n      return child(scope, function (e) {\n        return is(e, selector);\n      });\n    };\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.URI');\n\n    var getToolbarItems = function (editor) {\n      return editor.getParam('imagetools_toolbar', 'rotateleft rotateright flipv fliph editimage imageoptions');\n    };\n    var getProxyUrl = function (editor) {\n      return editor.getParam('imagetools_proxy');\n    };\n    var getCorsHosts = function (editor) {\n      return editor.getParam('imagetools_cors_hosts', [], 'string[]');\n    };\n    var getCredentialsHosts = function (editor) {\n      return editor.getParam('imagetools_credentials_hosts', [], 'string[]');\n    };\n    var getFetchImage = function (editor) {\n      return Optional.from(editor.getParam('imagetools_fetch_image', null, 'function'));\n    };\n    var getApiKey = function (editor) {\n      return editor.getParam('api_key', editor.getParam('imagetools_api_key', '', 'string'), 'string');\n    };\n    var getUploadTimeout = function (editor) {\n      return editor.getParam('images_upload_timeout', 30000, 'number');\n    };\n    var shouldReuseFilename = function (editor) {\n      return editor.getParam('images_reuse_filename', false, 'boolean');\n    };\n\n    function getImageSize(img) {\n      var width, height;\n      function isPxValue(value) {\n        return /^[0-9\\.]+px$/.test(value);\n      }\n      width = img.style.width;\n      height = img.style.height;\n      if (width || height) {\n        if (isPxValue(width) && isPxValue(height)) {\n          return {\n            w: parseInt(width, 10),\n            h: parseInt(height, 10)\n          };\n        }\n        return null;\n      }\n      width = img.width;\n      height = img.height;\n      if (width && height) {\n        return {\n          w: parseInt(width, 10),\n          h: parseInt(height, 10)\n        };\n      }\n      return null;\n    }\n    function setImageSize(img, size) {\n      var width, height;\n      if (size) {\n        width = img.style.width;\n        height = img.style.height;\n        if (width || height) {\n          img.style.width = size.w + 'px';\n          img.style.height = size.h + 'px';\n          img.removeAttribute('data-mce-style');\n        }\n        width = img.width;\n        height = img.height;\n        if (width || height) {\n          img.setAttribute('width', String(size.w));\n          img.setAttribute('height', String(size.h));\n        }\n      }\n    }\n    function getNaturalImageSize(img) {\n      return {\n        w: img.naturalWidth,\n        h: img.naturalHeight\n      };\n    }\n\n    var count = 0;\n    var getFigureImg = function (elem) {\n      return child$1(SugarElement.fromDom(elem), 'img');\n    };\n    var isFigure = function (editor, elem) {\n      return editor.dom.is(elem, 'figure');\n    };\n    var isImage = function (editor, imgNode) {\n      return editor.dom.is(imgNode, 'img:not([data-mce-object],[data-mce-placeholder])');\n    };\n    var getEditableImage = function (editor, node) {\n      var isEditable = function (imgNode) {\n        return isImage(editor, imgNode) && (isLocalImage(editor, imgNode) || isCorsImage(editor, imgNode) || isNonNullable(getProxyUrl(editor)));\n      };\n      if (isFigure(editor, node)) {\n        return getFigureImg(node).bind(function (img) {\n          return isEditable(img.dom) ? Optional.some(img.dom) : Optional.none();\n        });\n      } else {\n        return isEditable(node) ? Optional.some(node) : Optional.none();\n      }\n    };\n    var displayError = function (editor, error) {\n      editor.notificationManager.open({\n        text: error,\n        type: 'error'\n      });\n    };\n    var getSelectedImage = function (editor) {\n      var elem = editor.selection.getNode();\n      var figureElm = editor.dom.getParent(elem, 'figure.image');\n      if (figureElm !== null && isFigure(editor, figureElm)) {\n        return getFigureImg(figureElm);\n      } else if (isImage(editor, elem)) {\n        return Optional.some(SugarElement.fromDom(elem));\n      } else {\n        return Optional.none();\n      }\n    };\n    var extractFilename = function (editor, url, group) {\n      var m = url.match(/(?:\\/|^)(([^\\/\\?]+)\\.(?:[a-z0-9.]+))(?:\\?|$)/i);\n      return isNonNullable(m) ? editor.dom.encode(m[group]) : null;\n    };\n    var createId = function () {\n      return 'imagetools' + count++;\n    };\n    var isLocalImage = function (editor, img) {\n      var url = img.src;\n      return url.indexOf('data:') === 0 || url.indexOf('blob:') === 0 || new global$4(url).host === editor.documentBaseURI.host;\n    };\n    var isCorsImage = function (editor, img) {\n      return global$1.inArray(getCorsHosts(editor), new global$4(img.src).host) !== -1;\n    };\n    var isCorsWithCredentialsImage = function (editor, img) {\n      return global$1.inArray(getCredentialsHosts(editor), new global$4(img.src).host) !== -1;\n    };\n    var defaultFetchImage = function (editor, img) {\n      if (isCorsImage(editor, img)) {\n        return getUrl(img.src, null, isCorsWithCredentialsImage(editor, img));\n      }\n      if (!isLocalImage(editor, img)) {\n        var proxyUrl = getProxyUrl(editor);\n        var src = proxyUrl + (proxyUrl.indexOf('?') === -1 ? '?' : '&') + 'url=' + encodeURIComponent(img.src);\n        var apiKey = getApiKey(editor);\n        return getUrl(src, apiKey, false);\n      }\n      return imageToBlob$1(img);\n    };\n    var imageToBlob$2 = function (editor, img) {\n      return getFetchImage(editor).fold(function () {\n        return defaultFetchImage(editor, img);\n      }, function (customFetchImage) {\n        return customFetchImage(img);\n      });\n    };\n    var findBlob = function (editor, img) {\n      var blobInfo = editor.editorUpload.blobCache.getByUri(img.src);\n      if (blobInfo) {\n        return global$3.resolve(blobInfo.blob());\n      }\n      return imageToBlob$2(editor, img);\n    };\n    var startTimedUpload = function (editor, imageUploadTimerState) {\n      var imageUploadTimer = global$2.setEditorTimeout(editor, function () {\n        editor.editorUpload.uploadImagesAuto();\n      }, getUploadTimeout(editor));\n      imageUploadTimerState.set(imageUploadTimer);\n    };\n    var cancelTimedUpload = function (imageUploadTimerState) {\n      global$2.clearTimeout(imageUploadTimerState.get());\n    };\n    var updateSelectedImage = function (editor, origBlob, ir, uploadImmediately, imageUploadTimerState, selectedImage, size) {\n      return ir.toBlob().then(function (blob) {\n        var uri, name, filename, blobInfo;\n        var blobCache = editor.editorUpload.blobCache;\n        uri = selectedImage.src;\n        var useFilename = origBlob.type === blob.type;\n        if (shouldReuseFilename(editor)) {\n          blobInfo = blobCache.getByUri(uri);\n          if (isNonNullable(blobInfo)) {\n            uri = blobInfo.uri();\n            name = blobInfo.name();\n            filename = blobInfo.filename();\n          } else {\n            name = extractFilename(editor, uri, 2);\n            filename = extractFilename(editor, uri, 1);\n          }\n        }\n        blobInfo = blobCache.create({\n          id: createId(),\n          blob: blob,\n          base64: ir.toBase64(),\n          uri: uri,\n          name: name,\n          filename: useFilename ? filename : undefined\n        });\n        blobCache.add(blobInfo);\n        editor.undoManager.transact(function () {\n          function imageLoadedHandler() {\n            editor.$(selectedImage).off('load', imageLoadedHandler);\n            editor.nodeChanged();\n            if (uploadImmediately) {\n              editor.editorUpload.uploadImagesAuto();\n            } else {\n              cancelTimedUpload(imageUploadTimerState);\n              startTimedUpload(editor, imageUploadTimerState);\n            }\n          }\n          editor.$(selectedImage).on('load', imageLoadedHandler);\n          if (size) {\n            editor.$(selectedImage).attr({\n              width: size.w,\n              height: size.h\n            });\n          }\n          editor.$(selectedImage).attr({ src: blobInfo.blobUri() }).removeAttr('data-mce-src');\n        });\n        return blobInfo;\n      });\n    };\n    var selectedImageOperation = function (editor, imageUploadTimerState, fn, size) {\n      return function () {\n        var imgOpt = getSelectedImage(editor);\n        return imgOpt.fold(function () {\n          displayError(editor, 'Could not find selected image');\n        }, function (img) {\n          return editor._scanForImages().then(function () {\n            return findBlob(editor, img.dom);\n          }).then(function (blob) {\n            return blobToImageResult(blob).then(fn).then(function (imageResult) {\n              return updateSelectedImage(editor, blob, imageResult, false, imageUploadTimerState, img.dom, size);\n            });\n          }).catch(function (error) {\n            displayError(editor, error);\n          });\n        });\n      };\n    };\n    var rotate$2 = function (editor, imageUploadTimerState, angle) {\n      return function () {\n        var imgOpt = getSelectedImage(editor);\n        var flippedSize = imgOpt.fold(function () {\n          return null;\n        }, function (img) {\n          var size = getImageSize(img.dom);\n          return size ? {\n            w: size.h,\n            h: size.w\n          } : null;\n        });\n        return selectedImageOperation(editor, imageUploadTimerState, function (imageResult) {\n          return rotate$1(imageResult, angle);\n        }, flippedSize)();\n      };\n    };\n    var flip$2 = function (editor, imageUploadTimerState, axis) {\n      return function () {\n        return selectedImageOperation(editor, imageUploadTimerState, function (imageResult) {\n          return flip$1(imageResult, axis);\n        })();\n      };\n    };\n    var handleDialogBlob = function (editor, imageUploadTimerState, img, originalSize, blob) {\n      return blobToImage$1(blob).then(function (newImage) {\n        var newSize = getNaturalImageSize(newImage);\n        if (originalSize.w !== newSize.w || originalSize.h !== newSize.h) {\n          if (getImageSize(img)) {\n            setImageSize(img, newSize);\n          }\n        }\n        URL.revokeObjectURL(newImage.src);\n        return blob;\n      }).then(blobToImageResult).then(function (imageResult) {\n        return updateSelectedImage(editor, blob, imageResult, true, imageUploadTimerState, img);\n      }).catch(function () {\n      });\n    };\n\n    var saveState = 'save-state';\n    var disable = 'disable';\n    var enable = 'enable';\n\n    var createState = function (blob) {\n      return {\n        blob: blob,\n        url: URL.createObjectURL(blob)\n      };\n    };\n    var makeOpen = function (editor, imageUploadTimerState) {\n      return function () {\n        var getLoadedSpec = function (currentState) {\n          return {\n            title: 'Edit Image',\n            size: 'large',\n            body: {\n              type: 'panel',\n              items: [{\n                  type: 'imagetools',\n                  name: 'imagetools',\n                  label: 'Edit Image',\n                  currentState: currentState\n                }]\n            },\n            buttons: [\n              {\n                type: 'cancel',\n                name: 'cancel',\n                text: 'Cancel'\n              },\n              {\n                type: 'submit',\n                name: 'save',\n                text: 'Save',\n                primary: true,\n                disabled: true\n              }\n            ],\n            onSubmit: function (api) {\n              var blob = api.getData().imagetools.blob;\n              originalImgOpt.each(function (originalImg) {\n                originalSizeOpt.each(function (originalSize) {\n                  handleDialogBlob(editor, imageUploadTimerState, originalImg.dom, originalSize, blob);\n                });\n              });\n              api.close();\n            },\n            onCancel: function () {\n            },\n            onAction: function (api, details) {\n              switch (details.name) {\n              case saveState:\n                if (details.value) {\n                  api.enable('save');\n                } else {\n                  api.disable('save');\n                }\n                break;\n              case disable:\n                api.disable('save');\n                api.disable('cancel');\n                break;\n              case enable:\n                api.enable('cancel');\n                break;\n              }\n            }\n          };\n        };\n        var originalImgOpt = getSelectedImage(editor);\n        var originalSizeOpt = originalImgOpt.map(function (origImg) {\n          return getNaturalImageSize(origImg.dom);\n        });\n        originalImgOpt.each(function (img) {\n          getEditableImage(editor, img.dom).each(function (_) {\n            findBlob(editor, img.dom).then(function (blob) {\n              var state = createState(blob);\n              editor.windowManager.open(getLoadedSpec(state));\n            });\n          });\n        });\n      };\n    };\n\n    var register = function (editor, imageUploadTimerState) {\n      global$1.each({\n        mceImageRotateLeft: rotate$2(editor, imageUploadTimerState, -90),\n        mceImageRotateRight: rotate$2(editor, imageUploadTimerState, 90),\n        mceImageFlipVertical: flip$2(editor, imageUploadTimerState, 'v'),\n        mceImageFlipHorizontal: flip$2(editor, imageUploadTimerState, 'h'),\n        mceEditImage: makeOpen(editor, imageUploadTimerState)\n      }, function (fn, cmd) {\n        editor.addCommand(cmd, fn);\n      });\n    };\n\n    var setup = function (editor, imageUploadTimerState, lastSelectedImageState) {\n      editor.on('NodeChange', function (e) {\n        var lastSelectedImage = lastSelectedImageState.get();\n        var selectedImage = getEditableImage(editor, e.element);\n        if (lastSelectedImage && !selectedImage.exists(function (img) {\n            return lastSelectedImage.src === img.src;\n          })) {\n          cancelTimedUpload(imageUploadTimerState);\n          editor.editorUpload.uploadImagesAuto();\n          lastSelectedImageState.set(null);\n        }\n        selectedImage.each(lastSelectedImageState.set);\n      });\n    };\n\n    var register$1 = function (editor) {\n      var cmd = function (command) {\n        return function () {\n          return editor.execCommand(command);\n        };\n      };\n      editor.ui.registry.addButton('rotateleft', {\n        tooltip: 'Rotate counterclockwise',\n        icon: 'rotate-left',\n        onAction: cmd('mceImageRotateLeft')\n      });\n      editor.ui.registry.addButton('rotateright', {\n        tooltip: 'Rotate clockwise',\n        icon: 'rotate-right',\n        onAction: cmd('mceImageRotateRight')\n      });\n      editor.ui.registry.addButton('flipv', {\n        tooltip: 'Flip vertically',\n        icon: 'flip-vertically',\n        onAction: cmd('mceImageFlipVertical')\n      });\n      editor.ui.registry.addButton('fliph', {\n        tooltip: 'Flip horizontally',\n        icon: 'flip-horizontally',\n        onAction: cmd('mceImageFlipHorizontal')\n      });\n      editor.ui.registry.addButton('editimage', {\n        tooltip: 'Edit image',\n        icon: 'edit-image',\n        onAction: cmd('mceEditImage'),\n        onSetup: function (buttonApi) {\n          var setDisabled = function () {\n            var disabled = getSelectedImage(editor).forall(function (element) {\n              return getEditableImage(editor, element.dom).isNone();\n            });\n            buttonApi.setDisabled(disabled);\n          };\n          editor.on('NodeChange', setDisabled);\n          return function () {\n            editor.off('NodeChange', setDisabled);\n          };\n        }\n      });\n      editor.ui.registry.addButton('imageoptions', {\n        tooltip: 'Image options',\n        icon: 'image',\n        onAction: cmd('mceImage')\n      });\n      editor.ui.registry.addContextMenu('imagetools', {\n        update: function (element) {\n          return getEditableImage(editor, element).fold(function () {\n            return [];\n          }, function (_) {\n            return [{\n                text: 'Edit image',\n                icon: 'edit-image',\n                onAction: cmd('mceEditImage')\n              }];\n          });\n        }\n      });\n    };\n\n    var register$2 = function (editor) {\n      editor.ui.registry.addContextToolbar('imagetools', {\n        items: getToolbarItems(editor),\n        predicate: function (elem) {\n          return getEditableImage(editor, elem).isSome();\n        },\n        position: 'node',\n        scope: 'node'\n      });\n    };\n\n    function Plugin () {\n      global.add('imagetools', function (editor) {\n        var imageUploadTimerState = Cell(0);\n        var lastSelectedImageState = Cell(null);\n        register(editor, imageUploadTimerState);\n        register$1(editor);\n        register$2(editor);\n        setup(editor, imageUploadTimerState, lastSelectedImageState);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}