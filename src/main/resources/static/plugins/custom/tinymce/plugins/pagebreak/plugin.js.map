{"version":3,"sources":["pagebreak/plugin.js"],"names":["global","tinymce","util","Tools","resolve","global$1","shouldSplitBlock","editor","getParam","getPlaceholderHtml","transparentSrc","add","addCommand","insertContent","register","ui","registry","addButton","icon","tooltip","onAction","execCommand","addMenuItem","text","register$1","separatorHtml","getSeparatorHtml","pageBreakSeparatorRegExp","RegExp","replace","a","on","e","content","serializer","addNodeFilter","nodes","node","className","i","length","attr","indexOf","parentNode","parent","schema","getBlockElements","name","type","value","raw","remove","setup","target","nodeName","dom","hasClass","setup$1"],"mappings":"CAQC,WACG,aAEA,IAAIA,EAASC,QAAQC,KAAKC,MAAMC,QAAQ,yBAEpCC,EAAWJ,QAAQC,KAAKC,MAAMC,QAAQ,eAKtCE,EAAmB,SAAUC,GAC/B,OAAOA,EAAOC,SAAS,yBAAyB,IAM9CC,EAAqB,WACvB,MAAO,aAAeJ,EAASK,eAAxB,2EAsEPV,EAAOW,IAAI,aAAa,SAAUJ,IApCrB,SAAUA,GACvBA,EAAOK,WAAW,gBAAgB,WAC5BN,EAAiBC,GACnBA,EAAOM,cAAc,MAAQJ,IAAuB,QAEpDF,EAAOM,cAAcJ,QAgCvBK,CAASP,GAnBI,SAAUA,GACzBA,EAAOQ,GAAGC,SAASC,UAAU,YAAa,CACxCC,KAAM,aACNC,QAAS,aACTC,SAAU,WACR,OAAOb,EAAOc,YAAY,mBAG9Bd,EAAOQ,GAAGC,SAASM,YAAY,YAAa,CAC1CC,KAAM,aACNL,KAAM,aACNE,SAAU,WACR,OAAOb,EAAOc,YAAY,mBAQ5BG,CAAWjB,GAtEH,SAAUA,GACpB,IAAIkB,EAdiB,SAAUlB,GAC/B,OAAOA,EAAOC,SAAS,sBAAuB,4BAa1BkB,CAAiBnB,GACjCoB,EAA2B,IAAIC,OAAOH,EAAcI,QAAQ,iCAAiC,SAAUC,GACzG,MAAO,KAAOA,KACZ,MACJvB,EAAOwB,GAAG,oBAAoB,SAAUC,GACtCA,EAAEC,QAAUD,EAAEC,QAAQJ,QAAQF,EAA0BlB,QAE1DF,EAAOwB,GAAG,WAAW,WACnBxB,EAAO2B,WAAWC,cAAc,OAAO,SAAUC,GAE/C,IADA,IAAsBC,EAAMC,EAAxBC,EAAIH,EAAMI,OACPD,KAGL,IADAD,GADAD,EAAOD,EAAMG,IACIE,KAAK,YACmC,IAAxCH,EAAUI,QAAQ,iBAAyB,CAC1D,IAAIC,EAAaN,EAAKO,OACtB,GAAIrC,EAAOsC,OAAOC,mBAAmBH,EAAWI,OAASzC,EAAiBC,GAAS,CACjFoC,EAAWK,KAAO,EAClBL,EAAWM,MAAQxB,EACnBkB,EAAWO,KAAM,EACjBb,EAAKc,SACL,SAEFd,EAAKW,KAAO,EACZX,EAAKY,MAAQxB,EACbY,EAAKa,KAAM,SA8CjBE,CAAM7C,GA7BI,SAAUA,GACtBA,EAAOwB,GAAG,eAAe,SAAUC,GACP,QAAtBA,EAAEqB,OAAOC,UAAsB/C,EAAOgD,IAAIC,SAASxB,EAAEqB,OAjDpD,mBAkDHrB,EAAEe,KAAO,gBA2BXU,CAAQlD,MA5FhB","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.6.2 (2020-12-08)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var getSeparatorHtml = function (editor) {\n      return editor.getParam('pagebreak_separator', '<!-- pagebreak -->');\n    };\n    var shouldSplitBlock = function (editor) {\n      return editor.getParam('pagebreak_split_block', false);\n    };\n\n    var getPageBreakClass = function () {\n      return 'mce-pagebreak';\n    };\n    var getPlaceholderHtml = function () {\n      return '<img src=\"' + global$1.transparentSrc + '\" class=\"' + getPageBreakClass() + '\" data-mce-resize=\"false\" data-mce-placeholder />';\n    };\n    var setup = function (editor) {\n      var separatorHtml = getSeparatorHtml(editor);\n      var pageBreakSeparatorRegExp = new RegExp(separatorHtml.replace(/[\\?\\.\\*\\[\\]\\(\\)\\{\\}\\+\\^\\$\\:]/g, function (a) {\n        return '\\\\' + a;\n      }), 'gi');\n      editor.on('BeforeSetContent', function (e) {\n        e.content = e.content.replace(pageBreakSeparatorRegExp, getPlaceholderHtml());\n      });\n      editor.on('PreInit', function () {\n        editor.serializer.addNodeFilter('img', function (nodes) {\n          var i = nodes.length, node, className;\n          while (i--) {\n            node = nodes[i];\n            className = node.attr('class');\n            if (className && className.indexOf('mce-pagebreak') !== -1) {\n              var parentNode = node.parent;\n              if (editor.schema.getBlockElements()[parentNode.name] && shouldSplitBlock(editor)) {\n                parentNode.type = 3;\n                parentNode.value = separatorHtml;\n                parentNode.raw = true;\n                node.remove();\n                continue;\n              }\n              node.type = 3;\n              node.value = separatorHtml;\n              node.raw = true;\n            }\n          }\n        });\n      });\n    };\n\n    var register = function (editor) {\n      editor.addCommand('mcePageBreak', function () {\n        if (shouldSplitBlock(editor)) {\n          editor.insertContent('<p>' + getPlaceholderHtml() + '</p>');\n        } else {\n          editor.insertContent(getPlaceholderHtml());\n        }\n      });\n    };\n\n    var setup$1 = function (editor) {\n      editor.on('ResolveName', function (e) {\n        if (e.target.nodeName === 'IMG' && editor.dom.hasClass(e.target, getPageBreakClass())) {\n          e.name = 'pagebreak';\n        }\n      });\n    };\n\n    var register$1 = function (editor) {\n      editor.ui.registry.addButton('pagebreak', {\n        icon: 'page-break',\n        tooltip: 'Page break',\n        onAction: function () {\n          return editor.execCommand('mcePageBreak');\n        }\n      });\n      editor.ui.registry.addMenuItem('pagebreak', {\n        text: 'Page break',\n        icon: 'page-break',\n        onAction: function () {\n          return editor.execCommand('mcePageBreak');\n        }\n      });\n    };\n\n    function Plugin () {\n      global.add('pagebreak', function (editor) {\n        register(editor);\n        register$1(editor);\n        setup(editor);\n        setup$1(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}