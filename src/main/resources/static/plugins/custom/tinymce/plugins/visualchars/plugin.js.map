{"version":3,"sources":["visualchars/plugin.js"],"names":["eq","call","id","t","global","tinymce","util","Tools","resolve","noop","constant","value","never","always","none","NONE","o","isNone","fold","n","_s","is","isSome","getOr","getOrThunk","thunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","some","a","constant_a","self","me","f","s","v","elementEq","b","Optional","isSimpleType","type","isString","x","Array","prototype","isPrototypeOf","constructor","name","String","isType","isBoolean","isNumber","xs","i","len","length","keys","Object","each$1","obj","props","k","window","Function","element","dom","nodeValue","isText","nodeType","set","key","console","error","setAttribute","rawSet","remove","removeAttribute","read","attr","getAttribute","get$1","split","supports","classList","add$1","clazz","nu","concat","join","add","remove$2","pred","r","push","remove$1","cleanClass","get$2","fromDom","node","SugarElement","fromHtml","html","scope","div","document","createElement","innerHTML","hasChildNodes","childNodes","fromTag","tag","fromText","text","createTextNode","fromPoint","docElm","y","elementFromPoint","charMap"," ","­","charMapToRegExp","regExp","_value","RegExp","regExpGlobal","selector","charMapToSelector","nbspClass","wrapCharWithSpan","isMatch","value$1","test","filterDescendants","predicate","result","children","isWrappedNbsp","nodeName","toLowerCase","contains","show","editor","rootElm","nodeList","parent","parentNode","withSpans","encode","replace","create","lastChild","insertAfter","hide","select","toggle","body","getBody","bookmark","selection","getBookmark","elm","findParentElm","getNode","moveToBookmark","applyVisualChars","toggleState","state","fire","fireVisualChars","get","register","addCommand","toggleVisualChars","global$1","toggleActiveState","enabledStated","api","setActive","editorEventCallback","e","on","off","initial","Cell","getParam","isEnabledByDefault","ui","registry","addToggleButton","tooltip","icon","onAction","execCommand","onSetup","addToggleMenuItem","register$1","debouncedToggle","debounce","hasForcedRootBlock","keyCode","stop","setup$1","setup","isEnabled"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.6.2 (2020-12-08)\n */\n(function () {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      return {\n        get: get,\n        set: set\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var get = function (toggleState) {\n      var isEnabled = function () {\n        return toggleState.get();\n      };\n      return { isEnabled: isEnabled };\n    };\n\n    var fireVisualChars = function (editor, state) {\n      return editor.fire('VisualChars', { state: state });\n    };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, _s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Optional = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf = function (x) {\n      var t = typeof x;\n      if (x === null) {\n        return 'null';\n      } else if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      } else if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      } else {\n        return t;\n      }\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isSimpleType = function (type) {\n      return function (value) {\n        return typeof value === type;\n      };\n    };\n    var isString = isType('string');\n    var isBoolean = isSimpleType('boolean');\n    var isNumber = isSimpleType('number');\n\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var filter = function (xs, pred) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          r.push(x);\n        }\n      }\n      return r;\n    };\n\n    var keys = Object.keys;\n    var each$1 = function (obj, f) {\n      var props = keys(obj);\n      for (var k = 0, len = props.length; k < len; k++) {\n        var i = props[k];\n        var x = obj[i];\n        f(x, i);\n      }\n    };\n\n    var Global = typeof window !== 'undefined' ? window : Function('return this;')();\n\n    var TEXT = 3;\n\n    var type = function (element) {\n      return element.dom.nodeType;\n    };\n    var value = function (element) {\n      return element.dom.nodeValue;\n    };\n    var isType$1 = function (t) {\n      return function (element) {\n        return type(element) === t;\n      };\n    };\n    var isText = isType$1(TEXT);\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        console.error('Invalid call to Attribute.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom, key, value);\n    };\n    var get$1 = function (element, key) {\n      var v = element.dom.getAttribute(key);\n      return v === null ? undefined : v;\n    };\n    var remove = function (element, key) {\n      element.dom.removeAttribute(key);\n    };\n\n    var read = function (element, attr) {\n      var value = get$1(element, attr);\n      return value === undefined || value === '' ? [] : value.split(' ');\n    };\n    var add = function (element, attr, id) {\n      var old = read(element, attr);\n      var nu = old.concat([id]);\n      set(element, attr, nu.join(' '));\n      return true;\n    };\n    var remove$1 = function (element, attr, id) {\n      var nu = filter(read(element, attr), function (v) {\n        return v !== id;\n      });\n      if (nu.length > 0) {\n        set(element, attr, nu.join(' '));\n      } else {\n        remove(element, attr);\n      }\n      return false;\n    };\n\n    var supports = function (element) {\n      return element.dom.classList !== undefined;\n    };\n    var get$2 = function (element) {\n      return read(element, 'class');\n    };\n    var add$1 = function (element, clazz) {\n      return add(element, 'class', clazz);\n    };\n    var remove$2 = function (element, clazz) {\n      return remove$1(element, 'class', clazz);\n    };\n\n    var add$2 = function (element, clazz) {\n      if (supports(element)) {\n        element.dom.classList.add(clazz);\n      } else {\n        add$1(element, clazz);\n      }\n    };\n    var cleanClass = function (element) {\n      var classList = supports(element) ? element.dom.classList : get$2(element);\n      if (classList.length === 0) {\n        remove(element, 'class');\n      }\n    };\n    var remove$3 = function (element, clazz) {\n      if (supports(element)) {\n        var classList = element.dom.classList;\n        classList.remove(clazz);\n      } else {\n        remove$2(element, clazz);\n      }\n      cleanClass(element);\n    };\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: node };\n    };\n    var fromPoint = function (docElm, x, y) {\n      return Optional.from(docElm.dom.elementFromPoint(x, y)).map(fromDom);\n    };\n    var SugarElement = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var charMap = {\n      '\\xA0': 'nbsp',\n      '\\xAD': 'shy'\n    };\n    var charMapToRegExp = function (charMap, global) {\n      var regExp = '';\n      each$1(charMap, function (_value, key) {\n        regExp += key;\n      });\n      return new RegExp('[' + regExp + ']', global ? 'g' : '');\n    };\n    var charMapToSelector = function (charMap) {\n      var selector = '';\n      each$1(charMap, function (value) {\n        if (selector) {\n          selector += ',';\n        }\n        selector += 'span.mce-' + value;\n      });\n      return selector;\n    };\n    var regExp = charMapToRegExp(charMap);\n    var regExpGlobal = charMapToRegExp(charMap, true);\n    var selector = charMapToSelector(charMap);\n    var nbspClass = 'mce-nbsp';\n\n    var wrapCharWithSpan = function (value) {\n      return '<span data-mce-bogus=\"1\" class=\"mce-' + charMap[value] + '\">' + value + '</span>';\n    };\n\n    var isMatch = function (n) {\n      var value$1 = value(n);\n      return isText(n) && value$1 !== undefined && regExp.test(value$1);\n    };\n    var filterDescendants = function (scope, predicate) {\n      var result = [];\n      var dom = scope.dom;\n      var children = map(dom.childNodes, SugarElement.fromDom);\n      each(children, function (x) {\n        if (predicate(x)) {\n          result = result.concat([x]);\n        }\n        result = result.concat(filterDescendants(x, predicate));\n      });\n      return result;\n    };\n    var findParentElm = function (elm, rootElm) {\n      while (elm.parentNode) {\n        if (elm.parentNode === rootElm) {\n          return elm;\n        }\n        elm = elm.parentNode;\n      }\n    };\n    var replaceWithSpans = function (text) {\n      return text.replace(regExpGlobal, wrapCharWithSpan);\n    };\n\n    var isWrappedNbsp = function (node) {\n      return node.nodeName.toLowerCase() === 'span' && node.classList.contains('mce-nbsp-wrap');\n    };\n    var show = function (editor, rootElm) {\n      var nodeList = filterDescendants(SugarElement.fromDom(rootElm), isMatch);\n      each(nodeList, function (n) {\n        var parent = n.dom.parentNode;\n        if (isWrappedNbsp(parent)) {\n          add$2(SugarElement.fromDom(parent), nbspClass);\n        } else {\n          var withSpans = replaceWithSpans(editor.dom.encode(value(n)));\n          var div = editor.dom.create('div', null, withSpans);\n          var node = void 0;\n          while (node = div.lastChild) {\n            editor.dom.insertAfter(node, n.dom);\n          }\n          editor.dom.remove(n.dom);\n        }\n      });\n    };\n    var hide = function (editor, rootElm) {\n      var nodeList = editor.dom.select(selector, rootElm);\n      each(nodeList, function (node) {\n        if (isWrappedNbsp(node)) {\n          remove$3(SugarElement.fromDom(node), nbspClass);\n        } else {\n          editor.dom.remove(node, true);\n        }\n      });\n    };\n    var toggle = function (editor) {\n      var body = editor.getBody();\n      var bookmark = editor.selection.getBookmark();\n      var parentNode = findParentElm(editor.selection.getNode(), body);\n      parentNode = parentNode !== undefined ? parentNode : body;\n      hide(editor, parentNode);\n      show(editor, parentNode);\n      editor.selection.moveToBookmark(bookmark);\n    };\n\n    var applyVisualChars = function (editor, toggleState) {\n      fireVisualChars(editor, toggleState.get());\n      var body = editor.getBody();\n      if (toggleState.get() === true) {\n        show(editor, body);\n      } else {\n        hide(editor, body);\n      }\n    };\n    var toggleVisualChars = function (editor, toggleState) {\n      toggleState.set(!toggleState.get());\n      var bookmark = editor.selection.getBookmark();\n      applyVisualChars(editor, toggleState);\n      editor.selection.moveToBookmark(bookmark);\n    };\n\n    var register = function (editor, toggleState) {\n      editor.addCommand('mceVisualChars', function () {\n        toggleVisualChars(editor, toggleState);\n      });\n    };\n\n    var isEnabledByDefault = function (editor) {\n      return editor.getParam('visualchars_default_state', false);\n    };\n    var hasForcedRootBlock = function (editor) {\n      return editor.getParam('forced_root_block') !== false;\n    };\n\n    var setup = function (editor, toggleState) {\n      editor.on('init', function () {\n        applyVisualChars(editor, toggleState);\n      });\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n\n    var setup$1 = function (editor, toggleState) {\n      var debouncedToggle = global$1.debounce(function () {\n        toggle(editor);\n      }, 300);\n      if (hasForcedRootBlock(editor)) {\n        editor.on('keydown', function (e) {\n          if (toggleState.get() === true) {\n            e.keyCode === 13 ? toggle(editor) : debouncedToggle();\n          }\n        });\n      }\n      editor.on('remove', debouncedToggle.stop);\n    };\n\n    var toggleActiveState = function (editor, enabledStated) {\n      return function (api) {\n        api.setActive(enabledStated.get());\n        var editorEventCallback = function (e) {\n          return api.setActive(e.state);\n        };\n        editor.on('VisualChars', editorEventCallback);\n        return function () {\n          return editor.off('VisualChars', editorEventCallback);\n        };\n      };\n    };\n    var register$1 = function (editor, toggleState) {\n      editor.ui.registry.addToggleButton('visualchars', {\n        tooltip: 'Show invisible characters',\n        icon: 'visualchars',\n        onAction: function () {\n          return editor.execCommand('mceVisualChars');\n        },\n        onSetup: toggleActiveState(editor, toggleState)\n      });\n      editor.ui.registry.addToggleMenuItem('visualchars', {\n        text: 'Show invisible characters',\n        icon: 'visualchars',\n        onAction: function () {\n          return editor.execCommand('mceVisualChars');\n        },\n        onSetup: toggleActiveState(editor, toggleState)\n      });\n    };\n\n    function Plugin () {\n      global.add('visualchars', function (editor) {\n        var toggleState = Cell(isEnabledByDefault(editor));\n        register(editor, toggleState);\n        register$1(editor, toggleState);\n        setup$1(editor, toggleState);\n        setup(editor, toggleState);\n        return get(toggleState);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}